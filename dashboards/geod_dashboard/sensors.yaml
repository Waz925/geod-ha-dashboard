- platform: rest
  name: "GEOD Token Balance"
  resource: https://api.polygonscan.com/api?module=account&action=tokenbalance&contractaddress=0xAC0F66379A6d7801D7726d5a943356A172549Adb&address=!secret geod_wallet_address&tag=latest&apikey=!secret polygonscan_api_key
  value_template: >
    {{ (value_json.result | int) / 1e18 | round(2) }}
  unit_of_measurement: "GEOD"
  scan_interval: 21600

- platform: rest
  name: "GEOD Price"
  resource: https://whitebit.com/api/v4/public/ticker?market=GEOD_USDT
  value_template: "{{ value_json.last }}"
  unit_of_measurement: "USD"
  scan_interval: 3600

- platform: template
  sensors:
    geod_next_update:
      friendly_name: "Next GEOD Update"
      value_template: >
        {% set last = as_timestamp(states.sensor.geod_token_balance.last_updated) %}
        {{ (last + 21600) | timestamp_local }}

    geod_tokens_received_today:
      friendly_name: "GEOD Received Today"
      value_template: >
        {{ (states('sensor.geod_token_balance') | float - states('input_number.geod_previous_balance') | float) | round(2) }}
      unit_of_measurement: "GEOD"

    geod_balance_usd:
      friendly_name: "GEOD Balance (USD)"
      value_template: >
        {% set balance = states('sensor.geod_token_balance') | float %}
        {% set price = states('sensor.geod_price') | float %}
        {{ (balance * price) | round(2) }}
      unit_of_measurement: "USD"
      icon_template: mdi:currency-usd

- platform: statistics
  name: "GEOD Daily Rewards History"
  entity_id: input_number.geod_tokens_received_today_snapshot
  state_characteristic: mean
  max_age:
    days: 7
  sampling_size: 7
  precision: 2
